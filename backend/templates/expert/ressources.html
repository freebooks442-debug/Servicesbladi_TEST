{% extends 'expert/base.html' %}
{% load static %}

{% block title %}Gestion des Ressources - MRE{% endblock %}
{% block meta_description %}Gestion des ressources et documentation - Espace expert{% endblock %}
{% block meta_keywords %}ressources, expert, documents, guides, procédures{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 py-6">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-8">
      <div>
        <h1 class="text-3xl font-bold text-gray-900">Gestion des Ressources</h1>
        <p class="mt-2 text-gray-600">Gérez et organisez vos ressources et documents</p>
      </div>
      <div class="mt-4 sm:mt-0">
        <button onclick="openModal('addResourceModal')" class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
          </svg>
          Ajouter une ressource
        </button>
      </div>
    </div>

    <!-- Filters -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
      <form method="get" action="{% url 'expert_ressources' %}" id="filterForm">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          <div>
            <label for="category-filter" class="block text-sm font-medium text-gray-700 mb-2">Catégorie</label>
            <select id="category-filter" name="category" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
              <option value="">Toutes les catégories</option>
              <option value="administratif" {% if request.GET.category == 'administratif' %}selected{% endif %}>Administratif</option>
              <option value="fiscal" {% if request.GET.category == 'fiscal' %}selected{% endif %}>Fiscal</option>
              <option value="investissement" {% if request.GET.category == 'investissement' %}selected{% endif %}>Investissement</option>
              <option value="tourisme" {% if request.GET.category == 'tourisme' %}selected{% endif %}>Tourisme</option>
              <option value="immobilier" {% if request.GET.category == 'immobilier' %}selected{% endif %}>Immobilier</option>
              <option value="social" {% if request.GET.category == 'social' %}selected{% endif %}>Social</option>
            </select>
          </div>
          <div class="md:col-span-2">
            <label for="search-filter" class="block text-sm font-medium text-gray-700 mb-2">Recherche</label>
            <input type="text" id="search-filter" name="search" placeholder="Rechercher une ressource..." value="{{ request.GET.search }}" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
          <div>
            <label for="sort-filter" class="block text-sm font-medium text-gray-700 mb-2">Trier par</label>
            <select id="sort-filter" name="sort" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
              <option value="recent" {% if request.GET.sort == 'recent' %}selected{% endif %}>Plus récent</option>
              <option value="name" {% if request.GET.sort == 'name' %}selected{% endif %}>Nom</option>
              <option value="popular" {% if request.GET.sort == 'popular' %}selected{% endif %}>Plus populaire</option>
            </select>
          </div>
        </div>
        <div class="mt-4">
          <button type="submit" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.707A1 1 0 013 7V4z"/>
            </svg>
            Filtrer
          </button>
        </div>
      </form>
    </div>

    <!-- Resources Grid -->
    <div>
      <h2 class="text-xl font-semibold text-gray-900 mb-6">Ressources</h2>
      {% if resources %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {% for resource in resources %}
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow duration-300">
              <div class="p-6">
                <div class="flex items-start mb-4">
                  <div class="flex-shrink-0">
                    {% if resource.category == 'guide' %}
                      <svg class="h-8 w-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                      </svg>
                    {% elif resource.category == 'form' %}
                      <svg class="h-8 w-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                      </svg>
                    {% elif resource.category == 'template' %}
                      <svg class="h-8 w-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                      </svg>
                    {% else %}
                      <svg class="h-8 w-8 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v2M7 7h10"/>
                      </svg>
                    {% endif %}
                  </div>
                  <div class="ml-4 flex-1">
                    <h3 class="text-lg font-medium text-gray-900 mb-2">{{ resource.title }}</h3>
                    <div class="flex flex-wrap gap-2 mb-2">
                      {% if resource.category == 'guide' %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                          Guide
                        </span>
                      {% elif resource.category == 'form' %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                          Formulaire
                        </span>
                      {% elif resource.category == 'template' %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                          Modèle
                        </span>
                      {% else %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800">
                          Procédure
                        </span>
                      {% endif %}
                      
                      {% if resource.category == 'administratif' %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                          Administratif
                        </span>
                      {% elif resource.category == 'fiscal' %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                          Fiscal
                        </span>
                      {% elif resource.category == 'investissement' %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800">
                          Investissement
                        </span>
                      {% elif resource.category == 'tourisme' %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-pink-100 text-pink-800">
                          Tourisme
                        </span>
                      {% elif resource.category == 'immobilier' %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                          Immobilier
                        </span>
                      {% elif resource.category == 'social' %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-teal-100 text-teal-800">
                          Social
                        </span>
                      {% else %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                          {{ resource.category|title }}
                        </span>
                      {% endif %}
                    </div>
                  </div>
                </div>
                <p class="text-sm text-gray-600 mb-4">{{ resource.description|truncatechars:120 }}</p>
                <div class="flex items-center justify-between text-xs text-gray-500 mb-4">
                  <span>Mis à jour: {{ resource.updated_at|date:"d/m/Y" }}</span>
                </div>
                <div class="flex flex-wrap gap-2">
                  <a href="{% url 'resources:edit_resource' resource.id %}" class="inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                    </svg>
                    Modifier
                  </a>
                  {% if resource.files.first %}
                    <a href="{{ resource.files.first.file.url }}" download class="inline-flex items-center px-3 py-1.5 border border-green-300 shadow-sm text-xs font-medium rounded text-green-700 bg-green-50 hover:bg-green-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                      <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                      </svg>
                      Télécharger
                    </a>
                  {% endif %}
                  <a href="{% url 'resources:delete_resource' resource.id %}" onclick="return confirm('Êtes-vous sûr de vouloir supprimer cette ressource?');" class="inline-flex items-center px-3 py-1.5 border border-red-300 shadow-sm text-xs font-medium rounded text-red-700 bg-red-50 hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                    Supprimer
                  </a>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="text-center py-12">
          <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
          </svg>
          <h3 class="mt-2 text-sm font-medium text-gray-900">Aucune ressource</h3>
          <p class="mt-1 text-sm text-gray-500">Aucune ressource disponible. Ajoutez votre première ressource en cliquant sur le bouton "Ajouter une ressource".</p>
          <div class="mt-6">
            <button onclick="openModal('addResourceModal')" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
              </svg>
              Ajouter une ressource
            </button>
          </div>
        </div>
      {% endif %}
    </div>
  </div>
</div>

<!-- Add Resource Modal -->
<div id="addResourceModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden">
  <div class="relative top-20 mx-auto p-5 border max-w-lg shadow-lg rounded-md bg-white">
    <div class="mt-3">
      <h3 class="text-lg leading-6 font-medium text-gray-900 text-center mb-6">Ajouter une ressource</h3>
      <form method="post" action="{% url 'resources:expert_add_resource' %}" enctype="multipart/form-data" class="space-y-4">
        {% csrf_token %}
        
        <div>
          <label for="resource_title" class="block text-sm font-medium text-gray-700 mb-2">Titre <span class="text-red-500">*</span></label>
          <input type="text" id="resource_title" name="title" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
        </div>
        
        <div>
          <label for="resource_category" class="block text-sm font-medium text-gray-700 mb-2">Catégorie <span class="text-red-500">*</span></label>
          <select id="resource_category" name="category" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            <option value="">Sélectionner une catégorie</option>
            <option value="guide">Guide</option>
            <option value="form">Formulaire</option>
            <option value="documentation">Documentation</option>
            <option value="procedure">Procédure</option>
            <option value="video">Vidéo</option>
            <option value="tool">Outil</option>
            <option value="other">Autre</option>
          </select>
        </div>
        
        <div>
          <label for="resource_description" class="block text-sm font-medium text-gray-700 mb-2">Description <span class="text-red-500">*</span></label>
          <textarea id="resource_description" name="description" rows="3" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Décrivez votre ressource..."></textarea>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Langues disponibles</label>
          <div class="space-y-2">
            <div class="flex items-center">
              <input id="lang_fr" type="checkbox" name="languages" value="fr" checked class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
              <label for="lang_fr" class="ml-2 block text-sm text-gray-900">Français</label>
            </div>
            <div class="flex items-center">
              <input id="lang_en" type="checkbox" name="languages" value="en" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
              <label for="lang_en" class="ml-2 block text-sm text-gray-900">English</label>
            </div>
            <div class="flex items-center">
              <input id="lang_ar" type="checkbox" name="languages" value="ar" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
              <label for="lang_ar" class="ml-2 block text-sm text-gray-900">العربية</label>
            </div>
          </div>
        </div>
        
        <div>
          <label for="resource_files" class="block text-sm font-medium text-gray-700 mb-2">Fichiers</label>
          <input type="file" id="resource_files" name="files" multiple class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          <p class="mt-1 text-sm text-gray-500">Vous pouvez sélectionner plusieurs fichiers</p>
        </div>
        
        <div id="links-container">
          <label class="block text-sm font-medium text-gray-700 mb-2">Liens externes</label>
          <div class="space-y-2">
            <div class="grid grid-cols-2 gap-2">
              <input type="text" name="links" placeholder="URL du lien" class="px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
              <input type="text" name="link_titles" placeholder="Titre du lien" class="px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            </div>
            <button type="button" id="addLinkBtn" class="inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-sm font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
              <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
              </svg>
              Ajouter un autre lien
            </button>
          </div>
        </div>
        
        <div class="flex items-center">
          <input id="is_active" type="checkbox" name="is_active" checked class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
          <label for="is_active" class="ml-2 block text-sm text-gray-900">Ressource active (visible pour les utilisateurs)</label>
        </div>
        
        <div class="flex flex-col gap-3 pt-6">
          <button type="button" onclick="closeModal('addResourceModal')" class="w-full px-4 py-2 bg-gray-500 text-white text-base font-medium rounded-md shadow-sm hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-300">
            Annuler
          </button>
          <button type="submit" class="w-full px-4 py-2 bg-blue-500 text-white text-base font-medium rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-300">
            Ajouter la ressource
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
function openModal(modalId) {
  document.getElementById(modalId).classList.remove('hidden');
}

function closeModal(modalId) {
  document.getElementById(modalId).classList.add('hidden');
}

// Close modal when clicking outside
window.addEventListener('click', function(event) {
  const modal = document.getElementById('addResourceModal');
  if (event.target === modal) {
    closeModal('addResourceModal');
  }
});

document.addEventListener('DOMContentLoaded', function() {
  // Handle form submission with AJAX
  const resourceForm = document.querySelector('#addResourceModal form');
  if (resourceForm) {
    resourceForm.addEventListener('submit', function(event) {
      event.preventDefault();
      
      const formData = new FormData(this);
      
      // Show loading indicator
      const submitBtn = this.querySelector('button[type="submit"]');
      const originalText = submitBtn.innerHTML;
      submitBtn.innerHTML = '<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Traitement...';
      submitBtn.disabled = true;
      
      fetch('/resources/expert/add/', {
        method: 'POST',
        body: formData,
        headers: {
          'X-Requested-With': 'XMLHttpRequest'
        }
      })
      .then(response => response.json())
      .then(data => {
        console.log("Server response:", data);
        
        // Restore button
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
        
        if (data.success) {
          // Close modal
          closeModal('addResourceModal');
          
          // Show success message (you can customize this)
          alert(data.message || 'Ressource ajoutée avec succès!');
          
          // Reload page after 1 second
          setTimeout(() => {
            console.log("Reloading page after successful addition...");
            window.location.reload();
          }, 1000);
        } else {
          // Show error message
          alert(data.error || 'Une erreur est survenue lors de l\'ajout de la ressource.');
        }
      })
      .catch(error => {
        // Restore button
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
        
        // Show error message
        alert('Erreur de connexion au serveur. Veuillez réessayer.');
        console.error('Error:', error);
      });
    });
  }

  // Dynamic link addition
  const linksContainer = document.getElementById('links-container');
  const addLinkBtn = document.getElementById('addLinkBtn');
  
  if (addLinkBtn) {
    addLinkBtn.addEventListener('click', function() {
      const linkGroup = document.createElement('div');
      linkGroup.className = 'grid grid-cols-2 gap-2 mt-2';
      linkGroup.innerHTML = `
        <input type="text" name="links" placeholder="URL du lien" class="px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
        <div class="flex gap-2">
          <input type="text" name="link_titles" placeholder="Titre du lien" class="flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          <button type="button" class="px-2 py-2 border border-red-300 shadow-sm text-sm font-medium rounded text-red-700 bg-red-50 hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 remove-link">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
            </svg>
          </button>
        </div>
      `;
      
      // Insert before the add button
      const buttonContainer = addLinkBtn.parentElement;
      buttonContainer.parentNode.insertBefore(linkGroup, buttonContainer);
      
      // Add remove event listener
      const removeBtn = linkGroup.querySelector('.remove-link');
      removeBtn.addEventListener('click', function() {
        linkGroup.remove();
      });
    });
  }
  
  // Handle filter form
  const filterForm = document.getElementById('filterForm');
  if (filterForm) {
    filterForm.addEventListener('submit', function(event) {
      event.preventDefault();
      
      const category = document.getElementById('category-filter').value;
      const search = document.getElementById('search-filter').value;
      const sort = document.getElementById('sort-filter').value;
      
      // Build URL with parameters
      let url = window.location.pathname + '?';
      if (category) url += `category=${category}&`;
      if (search) url += `search=${encodeURIComponent(search)}&`;
      if (sort) url += `sort=${sort}`;
      
      // Redirect to URL with filters
      window.location.href = url;
    });
  }
});
</script>
{% endblock %}
