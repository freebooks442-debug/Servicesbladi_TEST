{% load static %}
<!DOCTYPE html>
<html lang="{% if LANGUAGE_CODE %}{{ LANGUAGE_CODE }}{% else %}fr{% endif %}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Administration - ServicesBLADI{% endblock %}</title>
  <meta name="description" content="Panel d'administration ServicesBLADI">
  
  <!-- Favicons -->
  <link rel="icon" type="image/png" href="{% static 'img/logo.png' %}">
  <link href="{% static 'img/apple-touch-icon.png' %}" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#2563eb',
            secondary: '#64748b',
            accent: '#f59e0b',
            success: '#10b981',
            warning: '#f59e0b',
            danger: '#ef4444',
            info: '#3b82f6',
            dark: '#1f2937',
          },
          fontFamily: {
            'sans': ['Inter', 'system-ui', 'sans-serif'],
          }
        }
      }
    }
  </script>
  
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  
  {% block head_extras %}{% endblock %}
</head>

<body class="bg-gray-50 font-sans">
  <div class="flex h-screen overflow-hidden">
    
    <!-- Modern Sidebar -->
    <div id="sidebar" class="fixed inset-y-0 left-0 z-50 w-72 bg-white border-r border-gray-200 shadow-xl transform transition-transform duration-300 ease-in-out lg:translate-x-0 lg:static lg:inset-0">
      
      <!-- Logo Section -->
      <div class="flex items-center justify-center h-20 px-6 border-b border-gray-100 bg-gradient-to-r from-blue-600 to-blue-700">
        <div class="flex items-center space-x-3">
          <div class="w-10 h-10 bg-white rounded-xl flex items-center justify-center shadow-lg">
            <img src="{% static 'img/logo.png' %}" alt="Logo" class="h-8 w-8">
          </div>
          <div class="text-white">
            <h1 class="text-xl font-bold">ServicesBLADI</h1>
            <p class="text-xs text-blue-100">Administration</p>
          </div>
        </div>
      </div>
      
      <!-- Admin Profile Section -->
      <div class="px-6 py-6 bg-gradient-to-r from-gray-50 to-blue-50 border-b border-gray-100">
        <div class="flex items-center space-x-4">
          <div class="relative">
            <img class="h-14 w-14 rounded-full object-cover ring-4 ring-white shadow-lg" src="{{ user.get_profile_picture_url }}" alt="{{ user.get_full_name }}">
            <div class="absolute -bottom-1 -right-1 w-5 h-5 bg-green-400 rounded-full border-2 border-white pulse"></div>
          </div>
          <div class="flex-1 min-w-0">
            <div class="text-sm font-semibold text-gray-900 truncate">{{ user.get_full_name|default:user.username }}</div>
            <div class="flex items-center space-x-2">
              <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                <i class="bi bi-shield-check text-blue-600 mr-1"></i>
                Administrateur
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Navigation -->
      <nav class="flex-1 px-4 py-6 space-y-2 overflow-y-auto">
        
        <!-- Main Navigation -->
        <div class="space-y-1">
          <div class="px-3 py-2">
            <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Navigation Principale</h3>
          </div>
          
          <a href="{% url 'admin_dashboard' %}" class="nav-link {% if request.resolver_match.url_name == 'admin_dashboard' %}active{% endif %}">
            <div class="flex items-center">
              <div class="flex-shrink-0 w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center nav-icon">
                <i class="bi bi-speedometer2 text-blue-600"></i>
              </div>
              <span class="ml-3 font-medium">Tableau de bord</span>
            </div>
          </a>
          
          <a href="{% url 'admin_users' %}" class="nav-link {% if request.resolver_match.url_name == 'admin_users' or request.resolver_match.url_name == 'admin_user_detail' %}active{% endif %}">
            <div class="flex items-center">
              <div class="flex-shrink-0 w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center nav-icon">
                <i class="bi bi-people text-green-600"></i>
              </div>
              <span class="ml-3 font-medium">Utilisateurs</span>
            </div>
          </a>
          
          <a href="{% url 'admin_demandes' %}" class="nav-link {% if request.resolver_match.url_name == 'admin_demandes' %}active{% endif %}">
            <div class="flex items-center">
              <div class="flex-shrink-0 w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center nav-icon">
                <i class="bi bi-file-earmark-text text-orange-600"></i>
              </div>
              <span class="ml-3 font-medium">Demandes</span>
            </div>
          </a>
          
          <a href="{% url 'admin_rendezvous' %}" class="nav-link {% if request.resolver_match.url_name == 'admin_rendezvous' %}active{% endif %}">
            <div class="flex items-center">
              <div class="flex-shrink-0 w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center nav-icon">
                <i class="bi bi-calendar-event text-purple-600"></i>
              </div>
              <span class="ml-3 font-medium">Rendez-vous</span>
            </div>
          </a>
          
          <a href="{% url 'admin_messages' %}" class="nav-link {% if request.resolver_match.url_name == 'admin_messages' %}active{% endif %}">
            <div class="flex items-center">
              <div class="flex-shrink-0 w-8 h-8 bg-pink-100 rounded-lg flex items-center justify-center nav-icon">
                <i class="bi bi-chat-dots text-pink-600"></i>
              </div>
              <span class="ml-3 font-medium">Messages</span>
            </div>
          </a>
          
          <a href="{% url 'admin_documents' %}" class="nav-link {% if request.resolver_match.url_name == 'admin_documents' %}active{% endif %}">
            <div class="flex items-center">
              <div class="flex-shrink-0 w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center nav-icon">
                <i class="bi bi-file-earmark text-indigo-600"></i>
              </div>
              <span class="ml-3 font-medium">Documents</span>
            </div>
          </a>
          
          <a href="{% url 'admin_ressources' %}" class="nav-link {% if request.resolver_match.url_name == 'admin_ressources' %}active{% endif %}">
            <div class="flex items-center">
              <div class="flex-shrink-0 w-8 h-8 bg-teal-100 rounded-lg flex items-center justify-center nav-icon">
                <i class="bi bi-book text-teal-600"></i>
              </div>
              <span class="ml-3 font-medium">Ressources</span>
            </div>
          </a>
        </div>
        
        <!-- Account Section -->
        <div class="pt-6 mt-6 border-t border-gray-200">
          <div class="px-3 py-2">
            <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Compte</h3>
          </div>
          
          <a href="{% url 'admin_profile' %}" class="nav-link">
            <div class="flex items-center">
              <div class="flex-shrink-0 w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center nav-icon">
                <i class="bi bi-person-gear text-gray-600"></i>
              </div>
              <span class="ml-3 font-medium">Mon Profil</span>
            </div>
          </a>
          
          <a href="{% url 'accounts:logout' %}" class="nav-link logout-link">
            <div class="flex items-center">
              <div class="flex-shrink-0 w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center nav-icon">
                <i class="bi bi-box-arrow-right text-red-600"></i>
              </div>
              <span class="ml-3 font-medium">Déconnexion</span>
            </div>
          </a>
        </div>
      </nav>
      
      <!-- Footer -->
      <div class="px-6 py-4 border-t border-gray-100 bg-gray-50">
        <div class="text-center">
          <p class="text-xs text-gray-500">© 2024 ServicesBLADI</p>
          <p class="text-xs text-gray-400">Version 1.0</p>
        </div>
      </div>
    </div>

    <!-- Mobile sidebar overlay -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 transition-opacity lg:hidden hidden backdrop-blur-sm" onclick="toggleSidebar()"></div>

    <!-- Main content -->
    <div class="flex-1 flex flex-col overflow-hidden lg:ml-0">
      
      <!-- Modern Top bar -->
      <header class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-40">
        <div class="flex items-center justify-between px-6 py-4">
          
          <!-- Mobile menu button -->
          <button onclick="toggleSidebar()" class="lg:hidden inline-flex items-center justify-center p-2 rounded-lg text-gray-500 hover:text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors">
            <i class="bi bi-list text-xl"></i>
          </button>
          
          <!-- Page title and breadcrumb -->
          <div class="flex-1 lg:flex lg:items-center lg:justify-between">
            <div class="flex-1 min-w-0">
              <div class="flex items-center space-x-2">
                <h1 class="text-2xl font-bold text-gray-900 sm:text-3xl">
                  {% block page_title %}Administration{% endblock %}
                </h1>
                <span class="hidden sm:inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                  Panel Admin
                </span>
              </div>
              {% block breadcrumb %}{% endblock %}
            </div>
          </div>
          
          <!-- Right side items -->
          <div class="flex items-center space-x-4">
            <!-- Space for future admin tools if needed -->
          </div>
        </div>
      </header>

      <!-- Main content area -->
      <main class="flex-1 overflow-y-auto bg-gray-50">
        <div class="p-6">
          {% block content %}
          <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-8">
              <div class="text-center py-12">
                <div class="w-16 h-16 bg-gradient-to-br from-blue-100 to-blue-200 rounded-2xl flex items-center justify-center mx-auto mb-4">
                  <i class="bi bi-gear text-3xl text-blue-600"></i>
                </div>
                <h3 class="text-xl font-semibold text-gray-900 mb-2">Contenu de la page</h3>
                <p class="text-gray-500 max-w-md mx-auto">Le contenu de cette page sera défini dans les templates enfants.</p>
              </div>
            </div>
          </div>
          {% endblock %}
        </div>
      </main>
    </div>
  </div>

  <style>
    .nav-link {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      text-decoration: none;
      color: #374151;
      border-radius: 12px;
      margin: 2px 0;
      transition: all 0.2s ease-in-out;
      font-weight: 500;
      position: relative;
      overflow: hidden;
    }
    
    .nav-link:hover {
      background-color: #f3f4f6;
      color: #1f2937;
      transform: translateX(2px);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    
    .nav-link.active {
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      color: white;
      box-shadow: 0 8px 25px -8px rgba(59, 130, 246, 0.4);
    }
    
    .nav-link.active .nav-icon {
      background-color: rgba(255, 255, 255, 0.2);
    }
    
    .nav-link.active .nav-icon i {
      color: white !important;
    }
    
    .nav-link:hover .nav-icon {
      transform: scale(1.05);
    }
    
    .nav-icon {
      transition: all 0.2s ease-in-out;
    }
    
    .logout-link:hover {
      background-color: #fef2f2;
      color: #dc2626;
    }
    
    .logout-link:hover .nav-icon {
      background-color: #fee2e2;
    }
    
    /* Custom scrollbar for navigation */
    nav::-webkit-scrollbar {
      width: 4px;
    }
    
    nav::-webkit-scrollbar-track {
      background: transparent;
    }
    
    nav::-webkit-scrollbar-thumb {
      background: #d1d5db;
      border-radius: 2px;
    }
    
    nav::-webkit-scrollbar-thumb:hover {
      background: #9ca3af;
    }
    
    /* Animation for sidebar */
    #sidebar {
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    /* Mobile responsive adjustments */
    @media (max-width: 1023px) {
      #sidebar {
        width: 280px;
      }
    }
    
    /* Pulse animation for online indicator */
    .pulse {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: .8;
      }
    }
  </style>

  <script>
    // Sidebar management
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebar-overlay');
      
      sidebar.classList.toggle('-translate-x-full');
      overlay.classList.toggle('hidden');
      
      // Add smooth animation
      if (!sidebar.classList.contains('-translate-x-full')) {
        overlay.style.opacity = '0';
        setTimeout(() => {
          overlay.style.opacity = '1';
        }, 50);
      }
    }
    
    // Close sidebar when clicking outside on mobile
    document.addEventListener('click', function(event) {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebar-overlay');
      const menuButton = event.target.closest('button[onclick="toggleSidebar()"]');
      
      if (!menuButton && !sidebar.contains(event.target) && !overlay.classList.contains('hidden')) {
        sidebar.classList.add('-translate-x-full');
        overlay.classList.add('hidden');
      }
    });
    
    // Handle responsive behavior
    window.addEventListener('resize', function() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebar-overlay');
      
      if (window.innerWidth >= 1024) {
        sidebar.classList.remove('-translate-x-full');
        overlay.classList.add('hidden');
      } else {
        sidebar.classList.add('-translate-x-full');
      }
    });
    
    // Initialize mobile state and add entrance animation
    document.addEventListener('DOMContentLoaded', function() {
      const sidebar = document.getElementById('sidebar');
      
      if (window.innerWidth < 1024) {
        sidebar.classList.add('-translate-x-full');
      }
      
      // Add entrance animation for nav links
      const navLinks = document.querySelectorAll('.nav-link');
      navLinks.forEach((link, index) => {
        link.style.opacity = '0';
        link.style.transform = 'translateX(-20px)';
        setTimeout(() => {
          link.style.transition = 'all 0.3s ease-out';
          link.style.opacity = '1';
          link.style.transform = 'translateX(0)';
        }, index * 50);
      });
    });
    
    // Add hover effect for better UX
    document.querySelectorAll('.nav-link').forEach(link => {
      link.addEventListener('mouseenter', function() {
        this.style.transform = 'translateX(4px)';
      });
      
      link.addEventListener('mouseleave', function() {
        if (!this.classList.contains('active')) {
          this.style.transform = 'translateX(0)';
        }
      });
    });
    
    // Keyboard navigation support
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebar-overlay');
        
        if (window.innerWidth < 1024 && !sidebar.classList.contains('-translate-x-full')) {
          sidebar.classList.add('-translate-x-full');
          overlay.classList.add('hidden');
        }
      }
    });

    // Listen for profile update messages
    window.addEventListener('message', function(event) {
      if (event.data.type === 'profileUpdated') {
        // Update all profile images in the current page
        const timestamp = event.data.timestamp || new Date().getTime();
        const profileImages = document.querySelectorAll('img[src*="profile_pictures"], img[alt*="profile"], img[alt*="Profile"]');
        profileImages.forEach(img => {
          const src = img.src;
          if (src.includes('?')) {
            img.src = src.split('?')[0] + '?v=' + timestamp;
          } else {
            img.src = src + '?v=' + timestamp;
          }
        });
      }
    });
  </script>
  
  {% block scripts %}{% endblock %}
</body>
</html>
