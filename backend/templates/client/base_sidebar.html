<!DOCTYPE html>
<html lang="fr" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}MRE{% endblock %}</title>
  <meta name="description" content="{% block meta_description %}{% endblock %}">
  <meta name="keywords" content="{% block meta_keywords %}{% endblock %}">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'primary': '#1e3c72',
            'secondary': '#C49A5A',
          },
          fontFamily: {
            'heading': ['Inter', 'system-ui', 'sans-serif'],
            'sans': ['Inter', 'system-ui', 'sans-serif'],
          }
        }
      }
    }
  </script>
  
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    .nav-link {
      @apply px-4 py-2 rounded-lg text-gray-700 hover:text-primary hover:bg-gray-100 transition-all duration-200 flex items-center space-x-2;
    }
    .nav-link.active {
      @apply bg-primary text-white;
    }
    .mobile-nav-link {
      @apply block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-primary hover:bg-gray-100 transition-all duration-200;
    }
    .mobile-nav-link.active {
      @apply bg-primary text-white;
    }
    .btn-primary {
      @apply bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-lg transition-all duration-200 inline-flex items-center justify-center;
    }
    .btn-secondary {
      @apply bg-secondary hover:bg-secondary/90 text-white font-medium py-2 px-4 rounded-lg transition-all duration-200 inline-flex items-center justify-center;
    }
    
    /* Enhanced Logo Styling */
    .logo-container {
      transition: all 0.3s ease;
    }
    .logo-container:hover {
      transform: translateY(-1px);
    }
    .logo-container:hover .logo-icon {
      transform: rotate(5deg);
    }
    .logo-icon {
      transition: transform 0.3s ease;
    }
    .brand-dot {
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(1.1); }
    }
    
    /* Profile Form Overlay */
    .profile-edit-form {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: none;
      z-index: 9999;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .profile-edit-form.show {
      opacity: 1;
    }

    .profile-edit-form .form-container {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border-radius: 15px;
      padding: 2rem;
      max-width: 500px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }

    .profile-edit-form .close-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      background: none;
      border: none;
      font-size: 1.5rem;
      color: #6b7280;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 50%;
      transition: all 0.3s ease;
    }

    .profile-edit-form .close-btn:hover {
      background-color: #f3f4f6;
      color: #374151;
    }
  </style>
  
  {% block extra_css %}{% endblock %}
</head>

<body class="bg-gray-50 font-sans h-full">
  <!-- Modern Top Navigation -->
  <nav class="bg-white shadow-lg border-b border-gray-200 fixed w-full top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <!-- Logo and Brand -->
        <div class="flex items-center">
          <div class="flex-shrink-0 flex items-center space-x-3">
            <!-- Logo Container with beautiful design -->
            <div class="relative logo-container">
              <div class="w-10 h-10 bg-gradient-to-br from-primary via-blue-600 to-secondary rounded-xl flex items-center justify-center shadow-lg hover:shadow-xl transition-all duration-300">
                <div class="w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center backdrop-blur-sm logo-icon">
                  <i class="bi bi-building text-white text-lg font-bold"></i>
                </div>
              </div>
              <!-- Decorative dot with animation -->
              <div class="absolute -top-1 -right-1 w-3 h-3 bg-secondary rounded-full border-2 border-white shadow-sm brand-dot"></div>
            </div>
            
            <!-- Brand Text with enhanced styling -->
            <div class="flex flex-col">
              <h1 class="text-xl font-bold bg-gradient-to-r from-primary via-blue-700 to-secondary bg-clip-text text-transparent leading-tight hover:from-blue-800 hover:to-primary transition-all duration-300">
                Services Bladi
              </h1>
              <div class="flex items-center space-x-2">
                <div class="w-1 h-1 bg-secondary rounded-full brand-dot"></div>
                <span class="text-xs text-gray-500 font-medium tracking-wide">ESPACE CLIENT</span>
                <div class="w-1 h-1 bg-primary rounded-full brand-dot" style="animation-delay: 1s;"></div>
              </div>
            </div>
          </div>
          
          <!-- User Info with better design -->
          <div class="hidden md:block ml-8">
            <div class="flex items-center space-x-2 bg-gradient-to-r from-gray-50 to-blue-50 px-4 py-2 rounded-xl border border-gray-200 shadow-sm hover:shadow-md transition-all duration-300">
              <div class="w-7 h-7 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center ring-2 ring-white shadow-sm">
                <i class="bi bi-person-fill text-white text-xs"></i>
              </div>
              <div class="flex flex-col">
                <span class="text-sm text-gray-700 font-semibold">{{ user.first_name }} {{ user.name }}</span>
                <span class="text-xs text-gray-500">Client MRE</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Desktop Navigation -->
        <div class="hidden md:flex items-center space-x-1">
          <a href="{% url 'client_dashboard' %}" class="nav-link {% if request.resolver_match.url_name == 'client_dashboard' %}active{% endif %}">
            <i class="bi bi-house"></i>
            <span>Accueil</span>
          </a>
          <a href="{% url 'client_demandes' %}" class="nav-link {% if request.resolver_match.url_name == 'client_demandes' %}active{% endif %}">
            <i class="bi bi-file-earmark-text"></i>
            <span>Demandes</span>
          </a>
          <a href="{% url 'custom_requests:client_appointments' %}" class="nav-link {% if 'appointment' in request.resolver_match.url_name %}active{% endif %}">
            <i class="bi bi-calendar-event"></i>
            <span>Rendez-vous</span>
          </a>
          <a href="{% url 'client_messages' %}" class="nav-link {% if request.resolver_match.url_name == 'client_messages' %}active{% endif %}">
            <i class="bi bi-chat-dots"></i>
            <span>Messages</span>
          </a>
          <a href="{% url 'client_documents' %}" class="nav-link {% if request.resolver_match.url_name == 'client_documents' %}active{% endif %}">
            <i class="bi bi-folder"></i>
            <span>Documents</span>
          </a>
          <a href="{% url 'client_ressources' %}" class="nav-link {% if request.resolver_match.url_name == 'client_ressources' %}active{% endif %}">
            <i class="bi bi-book"></i>
            <span>Ressources</span>
          </a>
        </div>

        <!-- User Menu -->
        <div class="flex items-center space-x-4">
          <!-- Notifications -->
          <div class="relative">
            <button class="relative p-2 rounded-full hover:bg-gray-100 transition-all duration-300" id="notificationButton">
              <i class="bi bi-bell text-xl text-gray-700"></i>
              {% if unread_notifications_count and unread_notifications_count > 0 %}
              <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">{{ unread_notifications_count }}</span>
              {% endif %}
            </button>
            
            <!-- Notification Dropdown -->
            <div class="absolute top-full right-0 mt-3 bg-white rounded-lg shadow-lg w-96 max-h-96 overflow-y-auto z-50 hidden" id="notificationDropdown">
              <div class="bg-primary text-white px-4 py-3 rounded-t-lg flex items-center justify-between">
                <h6 class="font-semibold mb-0 flex items-center"><i class="bi bi-bell mr-2"></i>Notifications</h6>
                <span class="bg-white text-primary text-xs px-2 py-1 rounded-full">{{ unread_notifications_count|default:"0" }} non lue(s)</span>
              </div>
              <div class="divide-y divide-gray-100">
                {% if notifications %}
                  {% for notification in notifications %}
                    <a href="{% url 'custom_requests:mark_notification_read' notification.id %}?redirect_url={% if notification.type == 'request_update' %}{% url 'client_demandes' %}{% elif notification.type == 'appointment' or notification.type == 'appointment_update' %}{% if notification.related_rendez_vous %}{% url 'custom_requests:appointment_detail' notification.related_rendez_vous.id %}{% else %}{% url 'custom_requests:client_appointments' %}{% endif %}{% elif notification.type == 'message' and notification.related_message %}{% url 'client_messages' %}?contact={{ notification.related_message.sender.id }}{% else %}{% url 'client_dashboard' %}{% endif %}" 
                       class="block px-4 py-3 hover:bg-gray-50 transition {% if not notification.is_read %}bg-blue-50 border-l-4 border-blue-500{% endif %}">
                      <div class="flex justify-content-between items-start mb-1">
                        <h6 class="font-semibold text-sm">{{ notification.title }}</h6>
                        {% if not notification.is_read %}
                          <span class="bg-blue-500 text-white text-xs px-2 py-1 rounded-full">Nouveau</span>
                        {% endif %}
                      </div>
                      <p class="text-gray-600 text-sm mb-1">{{ notification.content }}</p>
                      <span class="text-gray-400 text-xs">{{ notification.created_at|timesince }}</span>
                    </a>
                  {% endfor %}
                {% else %}
                  <div class="text-center p-6">
                    <i class="bi bi-bell-slash text-gray-400 text-3xl mb-2"></i>
                    <p class="text-gray-500">Aucune notification</p>
                  </div>
                {% endif %}
              </div>
            </div>
          </div>

          <!-- User Dropdown -->
          <div class="relative">
            <button class="flex items-center space-x-2 p-2 rounded-lg hover:bg-gray-100 transition-all duration-200" id="userMenuButton">
              <div class="w-8 h-8 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center text-white font-semibold text-sm">
                {% if user.first_name and user.first_name|length > 0 %}
                  {{ user.first_name.0|upper }}
                {% elif user.name and user.name|length > 0 %}
                  {{ user.name.0|upper }}
                {% else %}
                  U
                {% endif %}
              </div>
              <i class="bi bi-chevron-down text-gray-500"></i>
            </button>
            
            <!-- User Dropdown Menu -->
            <div class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 z-50 opacity-0 invisible transform scale-95 transition-all duration-200" id="userDropdownMenu">
              <div class="px-4 py-2 border-b border-gray-100">
                <p class="text-sm font-medium text-gray-900">{{ user.first_name }} {{ user.name }}</p>
                <p class="text-xs text-gray-500">{{ user.email }}</p>
              </div>
              <button class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center text-gray-700" id="editProfileBtn">
                <i class="bi bi-person-gear mr-2"></i>
                Modifier Profil
              </button>
              <form method="post" action="{% url 'accounts:logout' %}" class="block">
                {% csrf_token %}
                <button type="submit" class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center text-gray-700">
                  <i class="bi bi-box-arrow-right mr-2"></i>
                  Déconnexion
                </button>
              </form>
            </div>
          </div>

          <!-- Mobile Menu Button -->
          <button class="md:hidden p-2 rounded-lg hover:bg-gray-100" id="mobileMenuButton">
            <i class="bi bi-list text-xl"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Mobile Navigation Menu -->
    <div class="md:hidden hidden" id="mobileMenu">
      <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3 bg-white border-t border-gray-200">
        <a href="{% url 'client_dashboard' %}" class="mobile-nav-link {% if request.resolver_match.url_name == 'client_dashboard' %}active{% endif %}">
          <i class="bi bi-house mr-2"></i>
          Accueil
        </a>
        <a href="{% url 'client_demandes' %}" class="mobile-nav-link {% if request.resolver_match.url_name == 'client_demandes' %}active{% endif %}">
          <i class="bi bi-file-earmark-text mr-2"></i>
          Demandes
        </a>
        <a href="{% url 'custom_requests:client_appointments' %}" class="mobile-nav-link {% if 'appointment' in request.resolver_match.url_name %}active{% endif %}">
          <i class="bi bi-calendar-event mr-2"></i>
          Rendez-vous
        </a>
        <a href="{% url 'client_messages' %}" class="mobile-nav-link {% if request.resolver_match.url_name == 'client_messages' %}active{% endif %}">
          <i class="bi bi-chat-dots mr-2"></i>
          Messages
        </a>
        <a href="{% url 'client_documents' %}" class="mobile-nav-link {% if request.resolver_match.url_name == 'client_documents' %}active{% endif %}">
          <i class="bi bi-folder mr-2"></i>
          Documents
        </a>
        <a href="{% url 'client_ressources' %}" class="mobile-nav-link {% if request.resolver_match.url_name == 'client_ressources' %}active{% endif %}">
          <i class="bi bi-book mr-2"></i>
          Ressources
        </a>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="pt-16 min-h-screen bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      {% block content %}
      {% endblock %}
    </div>
  </main>

  <!-- Profile Edit Form Modal -->
  <div class="profile-edit-form" id="profileEditForm">
    <div class="form-container" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
      <button type="button" class="close-btn" id="closeProfileForm">
        <i class="bi bi-x"></i>
      </button>
      
      <div class="text-center mb-6">
        <div class="w-20 h-20 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center text-white font-bold text-2xl mx-auto mb-4 relative">
          {% if user.profile_picture %}
            <img src="{{ user.profile_picture.url }}" alt="Profile" class="w-full h-full rounded-full object-cover">
          {% else %}
            {% if user.first_name and user.first_name|length > 0 %}
              {{ user.first_name.0|upper }}
            {% elif user.name and user.name|length > 0 %}
              {{ user.name.0|upper }}
            {% else %}
              U
            {% endif %}
          {% endif %}
          <div class="absolute bottom-0 right-0 w-6 h-6 bg-white rounded-full flex items-center justify-center shadow-lg cursor-pointer hover:bg-gray-50" onclick="document.getElementById('profilePictureInput').click()">
            <i class="bi bi-camera text-primary text-xs"></i>
          </div>
        </div>
        <h3 class="text-2xl font-semibold text-gray-900">Modifier votre profil</h3>
        <p class="text-gray-600 text-sm">Mettez à jour vos informations personnelles et vos préférences</p>
      </div>

      <form id="userProfileForm" method="post" action="{% url 'accounts:edit_profile' %}" enctype="multipart/form-data">
        {% csrf_token %}
        
        <!-- Profile Picture Upload (Hidden) -->
        <input type="file" id="profilePictureInput" name="profile_picture" accept="image/*" style="display: none;" onchange="previewImage(this)">
        
        <div class="space-y-6">
          
          <!-- Personal Information Section -->
          <div class="bg-gray-50 rounded-lg p-4">
            <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
              <i class="bi bi-person-fill text-primary mr-2"></i>
              Informations personnelles
            </h4>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Nom de famille *</label>
                <input type="text" name="name" value="{{ user.name }}" 
                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary" 
                       required>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Prénom *</label>
                <input type="text" name="first_name" value="{{ user.first_name }}" 
                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary" 
                       required>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Date de naissance</label>
                <input type="date" name="birth_date" value="{{ user.birth_date|date:'Y-m-d' }}" 
                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Statut MRE</label>
                <select name="mre_status" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
                  <option value="True" {% if user.client_profile.mre_status %}selected{% endif %}>Oui, je suis MRE</option>
                  <option value="False" {% if not user.client_profile.mre_status %}selected{% endif %}>Non, je ne suis pas MRE</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Contact Information Section -->
          <div class="bg-gray-50 rounded-lg p-4">
            <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
              <i class="bi bi-envelope-fill text-primary mr-2"></i>
              Informations de contact
            </h4>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-1">Adresse email *</label>
                <input type="email" name="email" value="{{ user.email }}" 
                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary" 
                       required>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Numéro de téléphone</label>
                <input type="tel" name="phone" value="{{ user.phone }}" 
                       placeholder="+212 6XX-XX-XX-XX"
                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Langue préférée</label>
                <select name="preferred_languages" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
                  <option value="fr" {% if user.preferred_languages == 'fr' %}selected{% endif %}>Français</option>
                  <option value="ar" {% if user.preferred_languages == 'ar' %}selected{% endif %}>العربية</option>
                  <option value="en" {% if user.preferred_languages == 'en' %}selected{% endif %}>English</option>
                  <option value="es" {% if user.preferred_languages == 'es' %}selected{% endif %}>Español</option>
                  <option value="fr,ar" {% if user.preferred_languages == 'fr,ar' %}selected{% endif %}>Français + العربية</option>
                  <option value="fr,en" {% if user.preferred_languages == 'fr,en' %}selected{% endif %}>Français + English</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Location Information Section -->
          <div class="bg-gray-50 rounded-lg p-4">
            <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
              <i class="bi bi-geo-alt-fill text-primary mr-2"></i>
              Informations géographiques
            </h4>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Pays de résidence actuel</label>
                <select name="residence_country" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
                  <option value="">Sélectionner un pays</option>
                  <option value="MA" {% if user.residence_country == 'MA' %}selected{% endif %}>🇲🇦 Maroc</option>
                  <option value="FR" {% if user.residence_country == 'FR' %}selected{% endif %}>🇫🇷 France</option>
                  <option value="ES" {% if user.residence_country == 'ES' %}selected{% endif %}>🇪🇸 Espagne</option>
                  <option value="IT" {% if user.residence_country == 'IT' %}selected{% endif %}>🇮🇹 Italie</option>
                  <option value="DE" {% if user.residence_country == 'DE' %}selected{% endif %}>🇩🇪 Allemagne</option>
                  <option value="BE" {% if user.residence_country == 'BE' %}selected{% endif %}>🇧🇪 Belgique</option>
                  <option value="NL" {% if user.residence_country == 'NL' %}selected{% endif %}>🇳🇱 Pays-Bas</option>
                  <option value="CA" {% if user.residence_country == 'CA' %}selected{% endif %}>🇨🇦 Canada</option>
                  <option value="US" {% if user.residence_country == 'US' %}selected{% endif %}>🇺🇸 États-Unis</option>
                  <option value="GB" {% if user.residence_country == 'GB' %}selected{% endif %}>🇬🇧 Royaume-Uni</option>
                  <option value="AE" {% if user.residence_country == 'AE' %}selected{% endif %}>🇦🇪 Émirats Arabes Unis</option>
                  <option value="SA" {% if user.residence_country == 'SA' %}selected{% endif %}>🇸🇦 Arabie Saoudite</option>
                  <option value="QA" {% if user.residence_country == 'QA' %}selected{% endif %}>🇶🇦 Qatar</option>
                  <option value="other" {% if user.residence_country == 'other' %}selected{% endif %}>🌍 Autre pays</option>
                </select>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Pays d'origine</label>
                <select name="origin_country" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
                  <option value="Maroc" {% if user.client_profile.origin_country == 'Maroc' %}selected{% endif %}>🇲🇦 Maroc</option>
                  <option value="Algérie" {% if user.client_profile.origin_country == 'Algérie' %}selected{% endif %}>🇩🇿 Algérie</option>
                  <option value="Tunisie" {% if user.client_profile.origin_country == 'Tunisie' %}selected{% endif %}>🇹🇳 Tunisie</option>
                  <option value="Autre" {% if user.client_profile.origin_country == 'Autre' %}selected{% endif %}>🌍 Autre</option>
                </select>
              </div>
              
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-1">Dernière visite au Maroc</label>
                <input type="date" name="last_visit" value="{{ user.client_profile.last_visit|date:'Y-m-d' }}" 
                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
                <p class="text-xs text-gray-500 mt-1">Cette information nous aide à mieux vous servir</p>
              </div>
            </div>
          </div>

          <!-- Security Section -->
          <div class="bg-gray-50 rounded-lg p-4">
            <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
              <i class="bi bi-shield-check text-primary mr-2"></i>
              Sécurité du compte
            </h4>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Nouveau mot de passe</label>
                <input type="password" name="new_password" autocomplete="new-password"
                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary"
                       placeholder="Laisser vide pour ne pas changer">
                <p class="text-xs text-gray-500 mt-1">Minimum 8 caractères</p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Confirmer le mot de passe</label>
                <input type="password" name="confirm_password" autocomplete="new-password"
                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary"
                       placeholder="Retaper le nouveau mot de passe">
              </div>
            </div>
          </div>

          <!-- Account Information Section -->
          <div class="bg-blue-50 rounded-lg p-4">
            <h4 class="text-lg font-semibold text-gray-900 mb-3 flex items-center">
              <i class="bi bi-info-circle text-primary mr-2"></i>
              Informations du compte
            </h4>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
              <div class="flex items-center justify-between py-2 border-b border-blue-200">
                <span class="text-gray-600">Type de compte:</span>
                <span class="font-medium text-gray-900 capitalize">
                  {% if user.account_type == 'client' %}
                    <i class="bi bi-person-circle text-blue-600 mr-1"></i>Client
                  {% elif user.account_type == 'expert' %}
                    <i class="bi bi-mortarboard text-green-600 mr-1"></i>Expert
                  {% elif user.account_type == 'admin' %}
                    <i class="bi bi-shield-check text-red-600 mr-1"></i>Administrateur
                  {% endif %}
                </span>
              </div>
              <div class="flex items-center justify-between py-2 border-b border-blue-200">
                <span class="text-gray-600">Statut de vérification:</span>
                <span class="font-medium {% if user.is_verified %}text-green-600{% else %}text-orange-600{% endif %}">
                  {% if user.is_verified %}
                    <i class="bi bi-check-circle-fill mr-1"></i>Vérifié
                  {% else %}
                    <i class="bi bi-clock-fill mr-1"></i>En attente
                  {% endif %}
                </span>
              </div>
              <div class="flex items-center justify-between py-2">
                <span class="text-gray-600">Membre depuis:</span>
                <span class="font-medium text-gray-900">{{ user.registration_date|date:"d/m/Y" }}</span>
              </div>
              <div class="flex items-center justify-between py-2">
                <span class="text-gray-600">Dernière modification:</span>
                <span class="font-medium text-gray-900">{{ user.date_joined|date:"d/m/Y" }}</span>
              </div>
            </div>
          </div>
        </div>
        
        <div class="flex gap-3 mt-8 pt-6 border-t border-gray-200">
          <button type="button" class="flex-1 px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors font-medium" id="cancelProfileEdit">
            <i class="bi bi-x-circle mr-2"></i>
            Annuler
          </button>
          <button type="submit" class="flex-1 btn-primary">
            <i class="bi bi-check-circle mr-2"></i>
            Enregistrer les modifications
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- JavaScript -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Mobile menu toggle
      const mobileMenuButton = document.getElementById('mobileMenuButton');
      const mobileMenu = document.getElementById('mobileMenu');
      
      if (mobileMenuButton && mobileMenu) {
        mobileMenuButton.addEventListener('click', function() {
          mobileMenu.classList.toggle('hidden');
        });
      }
      
      // User dropdown
      const userMenuButton = document.getElementById('userMenuButton');
      const userDropdownMenu = document.getElementById('userDropdownMenu');
      
      if (userMenuButton && userDropdownMenu) {
        userMenuButton.addEventListener('click', function(e) {
          e.stopPropagation();
          userDropdownMenu.classList.toggle('opacity-0');
          userDropdownMenu.classList.toggle('invisible');
          userDropdownMenu.classList.toggle('scale-95');
          if (notificationDropdown) notificationDropdown.classList.add('hidden');
        });
      }
      
      // Notification dropdown
      const notificationButton = document.getElementById('notificationButton');
      const notificationDropdown = document.getElementById('notificationDropdown');
      
      if (notificationButton && notificationDropdown) {
        notificationButton.addEventListener('click', function(e) {
          e.stopPropagation();
          notificationDropdown.classList.toggle('hidden');
          if (userDropdownMenu) {
            userDropdownMenu.classList.add('opacity-0', 'invisible', 'scale-95');
          }
        });
      }
      
      // Profile edit functionality
      const editProfileBtn = document.getElementById('editProfileBtn');
      const profileEditForm = document.getElementById('profileEditForm');
      const closeProfileForm = document.getElementById('closeProfileForm');
      const cancelProfileEdit = document.getElementById('cancelProfileEdit');
      
      if (editProfileBtn && profileEditForm) {
        editProfileBtn.addEventListener('click', function(e) {
          e.preventDefault();
          profileEditForm.style.display = 'block';
          setTimeout(() => {
            profileEditForm.classList.add('show');
          }, 10);
          if (userDropdownMenu) {
            userDropdownMenu.classList.add('opacity-0', 'invisible', 'scale-95');
          }
        });
      }
      
      function closeProfile() {
        if (profileEditForm) {
          profileEditForm.classList.remove('show');
          setTimeout(() => {
            profileEditForm.style.display = 'none';
          }, 300);
        }
      }
      
      if (closeProfileForm) {
        closeProfileForm.addEventListener('click', closeProfile);
      }
      
      if (cancelProfileEdit) {
        cancelProfileEdit.addEventListener('click', closeProfile);
      }
      
      // Close dropdowns when clicking outside
      document.addEventListener('click', function() {
        if (notificationDropdown) notificationDropdown.classList.add('hidden');
        if (userDropdownMenu) {
          userDropdownMenu.classList.add('opacity-0', 'invisible', 'scale-95');
        }
        if (mobileMenu) mobileMenu.classList.add('hidden');
      });
      
      // Password confirmation validation
      const newPasswordInput = document.querySelector('input[name="new_password"]');
      const confirmPasswordInput = document.querySelector('input[name="confirm_password"]');
      
      if (confirmPasswordInput) {
        confirmPasswordInput.addEventListener('input', function() {
          if (this.value && newPasswordInput.value !== this.value) {
            this.setCustomValidity('Les mots de passe ne correspondent pas');
            this.classList.add('border-red-500');
            this.classList.remove('border-gray-300');
          } else {
            this.setCustomValidity('');
            this.classList.remove('border-red-500');
            this.classList.add('border-gray-300');
          }
        });
      }
    });
    
    // Profile picture preview function
    function previewImage(input) {
      if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const profileContainer = input.parentElement.querySelector('.w-20.h-20');
          if (profileContainer) {
            profileContainer.innerHTML = `
              <img src="${e.target.result}" alt="Profile Preview" class="w-full h-full rounded-full object-cover">
              <div class="absolute bottom-0 right-0 w-6 h-6 bg-white rounded-full flex items-center justify-center shadow-lg cursor-pointer hover:bg-gray-50" onclick="document.getElementById('profilePictureInput').click()">
                <i class="bi bi-camera text-primary text-xs"></i>
              </div>
            `;
          }
        };
        reader.readAsDataURL(input.files[0]);
      }
    }
  </script>

  {% block extra_scripts %}{% endblock %}
</body>
</html>
